{
    "id": "/elasticsearch/backend-api",
    "apps": [{
        "id": "/elasticsearch/backend-api/kibana",
        "instances": 1,
        "cpus": 1,
        "mem": 2048,
        "container": {
          "type": "DOCKER",
          "docker": {
            "image": "docker.elastic.co/kibana/kibana-oss:6.2.2",
            "network": "HOST",
            "parameters": [{
                "key": "volume-driver",
                "value": "rexray"
            }, {
                "key": "volume",
                "value": "es-backend-api-kibana:/usr/share/kibana/data"
            }]
          }
        },
        "env": {
            "ES_JAVA_OPTS": "-Xms1g -Xmx1g",
            "ELASTICSEARCH_URL": "http://master.backend-api-elasticsearch.service.consul:9200"
        },
        "labels":{
            "MARATHON_SINGLE_INSTANCE_APP": "true",
            "overrideTaskName": "backend-api-kibana",
            "tags": "external,http,protected"
        },
        "ports": [5601],
        "requirePorts" : true,
        "healthChecks": [{
            "protocol": "MESOS_HTTP",
            "gracePeriodSeconds": 60,
            "intervalSeconds": 5,
            "portIndex": 0,
            "timeoutSeconds": 5,
            "maxConsecutiveFailures": 3
        }],
        "upgradeStrategy":{
            "minimumHealthCapacity": 0,
            "maximumOverCapacity": 0
        }
    }, {
        "id": "/elasticsearch/backend-api/master-1",
        "instances": 1,
        "cpus": 1,
        "mem": 2048,
        "container": {
          "type": "DOCKER",
          "docker": {
            "image": "docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.2",
            "network": "HOST",
            "parameters": [{
                "key": "volume-driver",
                "value": "rexray"
            }, {
                "key": "volume",
                "value": "es-backend-api-master-1:/usr/share/elasticsearch/data"
            }, {
                "key": "ulimit",
                "value": "memlock=-1:-1"
            }]
          }
        },
        "env": {
            "ES_JAVA_OPTS": "-Xms1g -Xmx1g",
            "TAKE_FILE_OWNERSHIP": "1",
            "bootstrap.memory_lock": "true",
            "cluster.name": "backend-api-es",
            "network.publish_host": "${HOST}",
            "http.port": "9200",
            "http.publish_port": "9200",
            "transport.tcp.port": "9300",
            "transport.publish_port": "9300",
            "discovery.type": "single-node",
            "node.name": "backend-api-master-1",
            "node.master": "true",
            "node.data": "true",
            "node.ingest": "true",
            "search.remote.connect": "false",
            "discovery.zen.ping.unicast.hosts": "backend-api-elasticsearch.service.consul",
            "discovery.zen.minimum_master_nodes": "2"
        },
        "labels":{
            "MARATHON_SINGLE_INSTANCE_APP": "true",
            "overrideTaskName": "backend-api-elasticsearch"
        },
        "ports": [9200, 9300],
        "requirePorts" : true,
        "healthChecks": [{
            "protocol": "MESOS_HTTP",
            "gracePeriodSeconds": 60,
            "intervalSeconds": 5,
            "portIndex": 0,
            "timeoutSeconds": 5,
            "maxConsecutiveFailures": 3
        }],
        "upgradeStrategy":{
            "minimumHealthCapacity": 0,
            "maximumOverCapacity": 0
        }
    }]
}
